<head>
<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>
</head>

<body>

<%@center = Array.new %>
<%= @center << @event.coordinates.reverse %>
<%= @center.map { |lat, long| {lat: lat, lng: long, radius: 100}  }%>



 

 
<div class = "container" style = "width: 1000px" >
<div class = "row">
<div class = "span8">
  <div id="multi_overlays" class="span4" style=' height: 800px;'></div>
  <div id="All_Users" class="span4" style='height: 800px;' ></div>
</div>
</div>
</div>


  
  <div id="traditional_geofence" style='width: 800px; height: 800px;' align= "right"></div>

 




<script type="text/javascript">
var audiance = <%= @bsonPresentHash.to_json.html_safe %>
var data = <%= @polygons.to_json.html_safe %>

var handler = Gmaps.build('Google');

handler.buildMap({ internal: {id: 'multi_overlays'}}, function(){	

for (i = 0; i < data.length; i++){
	var polygonGeofence = handler.addPolygons(
		[
			data[i]
		]
	);
	 

}
 
 var markers = handler.addMarkers(audiance);
  
handler.bounds.extendWith(markers);
  
handler.bounds.extendWith(polygonGeofence);
  
 
  handler.fitMapToBounds();
  handler.getMap().setZoom(18);
});



</script>

<script type="text/javascript">

var audianceData = <%= @audiance.to_json.html_safe %>

var center = <%= @center.to_json.html_safe %>
var handler_circle = Gmaps.build('Google');
  
handler_circle.buildMap({ internal: {id: 'traditional_geofence'}}, function(){ 

 var circles = handler_circle.addCircles(
    [{lat: 53.360712, lng:-6.251208999999999, radius: 150}],
    { strokeColor: '#FF0000'}
  );

 var markers_circle = handler_circle.addMarkers(audianceData);
  
handler_circle.bounds.extendWith(markers_circle);
  

handler_circle.bounds.extendWith(circles);
  
 
  handler_circle.fitMapToBounds();
  handler_circle.getMap().setZoom(18);
});

</script>
<script type="text/javascript">

var audianceAll = <%= @totalNumberOfUsersHash.to_json.html_safe %>

var center = <%= @center.to_json.html_safe %>
var handler_circle = Gmaps.build('Google');
  
handler_circle.buildMap({ internal: {id: 'All_Users'}}, function(){ 

 var circles = handler_circle.addCircles(
    [{lat: 53.360712, lng:-6.251208999999999, radius: 150}],
    { strokeColor: '#FF0000'}
  );

 var markers_circle = handler_circle.addMarkers(audianceAll);
  
handler_circle.bounds.extendWith(markers_circle);
  

handler_circle.bounds.extendWith(circles);
  
 
  handler_circle.fitMapToBounds();
  handler_circle.getMap().setZoom(18);
});

</script>

</body>